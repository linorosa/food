#!/bin/bash

rm -rf dist
mkdir -p dist

index="dist/index.html"

touch $index
printf "<h1>Index</h1>\n" >> $index

printf "<ul>\n" >> $index

for f in $(find recipes -type f -regex ".*\.md")
do
 echo "Processing $f"

 # replaces .md with .html
 html="${f%.*}.html"

 # removes the recipes/ folder
 html="${html#*/}"

 # generate target file
 target="dist/$html"
 mkdir -p "$(dirname "$target")"
 pandoc -s $f -o $target

 title=$(pandoc "$f" --template=templates/metadata.pandoc-tpl | jq -r '.title')
 printf "<li><a href='$html'>$title</a></li>\n" >> $index

done

printf "</ul>\n" >> $index

